var J=Object.defineProperty;var s=(e,t)=>J(e,"name",{value:t,configurable:!0});import B from"os";import{PassThrough as U}from"stream";function X(e,t=1,r={}){const{indent:o=" ",includeEmptyLines:n=!1}=r;if(typeof e!="string")throw new TypeError(`Expected \`input\` to be a \`string\`, got \`${typeof e}\``);if(typeof t!="number")throw new TypeError(`Expected \`count\` to be a \`number\`, got \`${typeof t}\``);if(t<0)throw new RangeError(`Expected \`count\` to be at least 0, got \`${t}\``);if(typeof o!="string")throw new TypeError(`Expected \`options.indent\` to be a \`string\`, got \`${typeof o}\``);if(t===0)return e;const c=n?/^/gm:/^(?!\s*$)/gm;return e.replace(c,o.repeat(t))}s(X,"indentString");function Z(e){if(typeof e!="string")throw new TypeError("Expected a string");return e.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&").replace(/-/g,"\\x2d")}s(Z,"escapeStringRegexp");const Y=/\s+at.*[(\s](.*)\)?/,ee=/^(?:(?:(?:node|node:[\w/]+|(?:(?:node:)?internal\/[\w/]*|.*node_modules\/(?:babel-polyfill|pirates)\/.*)?\w+)(?:\.js)?:\d+:\d+)|native)/,te=typeof B.homedir=="undefined"?"":B.homedir().replace(/\\/g,"/");function re(e,{pretty:t=!1,basePath:r}={}){const o=r&&new RegExp(`(at | \\()${Z(r.replace(/\\/g,"/"))}`,"g");if(typeof e=="string")return e.replace(/\\/g,"/").split(`
`).filter(n=>{const c=n.match(Y);if(c===null||!c[1])return!0;const a=c[1];return a.includes(".app/Contents/Resources/electron.asar")||a.includes(".app/Contents/Resources/default_app.asar")||a.includes("node_modules/electron/dist/resources/electron.asar")||a.includes("node_modules/electron/dist/resources/default_app.asar")?!1:!ee.test(a)}).filter(n=>n.trim()!=="").map(n=>(o&&(n=n.replace(o,"$1")),t&&(n=n.replace(Y,(c,a)=>c.replace(a,a.replace(te,"~")))),n)).join(`
`)}s(re,"cleanStack");var ne=Object.defineProperty,P=s(e=>{throw TypeError(e)},"__typeError"),oe=s((e,t,r)=>t in e?ne(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,"__defNormalProp"),se=s((e,t,r)=>oe(e,t+"",r),"__publicField"),W=s((e,t,r)=>t.has(e)||P("Cannot "+r),"__accessCheck"),ie=s((e,t,r)=>(W(e,t,"read from private field"),r?r.call(e):t.get(e)),"__privateGet"),ae=s((e,t,r)=>t.has(e)?P("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,r),"__privateAdd"),ce=s((e,t,r,o)=>(W(e,t,"write to private field"),t.set(e,r),r),"__privateSet"),v;const le=s(e=>e.replace(/\s+at .*aggregate-error\/index.js:\d+:\d+\)?/g,""),"cleanInternalStack"),M=class M extends Error{constructor(t){if(!Array.isArray(t))throw new TypeError(`Expected input to be an Array, got ${typeof t}`);t=t.map(o=>o instanceof Error?o:o!==null&&typeof o=="object"?Object.assign(new Error(o.message),o):new Error(o));let r=t.map(o=>typeof o.stack=="string"&&o.stack.length>0?le(re(o.stack)):String(o)).join(`
`);r=`
`+X(r,4),super(r),ae(this,v),se(this,"name","AggregateError"),ce(this,v,t)}get errors(){return ie(this,v).slice()}};s(M,"AggregateError");let S=M;v=new WeakMap;const A=class A extends Error{constructor(t){super(),this.name="AbortError",this.message=t}};s(A,"AbortError");let N=A;const G=s(e=>globalThis.DOMException===void 0?new N(e):new DOMException(e),"getDOMException"),V=s(e=>{const t=e.reason===void 0?G("This operation was aborted."):e.reason;return t instanceof Error?t:G(t)},"getAbortedReason");async function ue(e,t,{concurrency:r=Number.POSITIVE_INFINITY,stopOnError:o=!0,signal:n}={}){return new Promise((c,a)=>{if(e[Symbol.iterator]===void 0&&e[Symbol.asyncIterator]===void 0)throw new TypeError(`Expected \`input\` to be either an \`Iterable\` or \`AsyncIterable\`, got (${typeof e})`);if(typeof t!="function")throw new TypeError("Mapper function is required");if(!((Number.isSafeInteger(r)||r===Number.POSITIVE_INFINITY)&&r>=1))throw new TypeError(`Expected \`concurrency\` to be an integer from 1 and up or \`Infinity\`, got \`${r}\` (${typeof r})`);const E=[],w=[],p=new Map;let T=!1,_=!1,C=!1,y=0,x=0;const I=e[Symbol.iterator]===void 0?e[Symbol.asyncIterator]():e[Symbol.iterator](),R=s(u=>{T=!0,_=!0,a(u)},"reject");n&&(n.aborted&&R(V(n)),n.addEventListener("abort",()=>{R(V(n))}));const i=s(async()=>{if(_)return;const u=await I.next(),f=x;if(x++,u.done){if(C=!0,y===0&&!_){if(!o&&w.length>0){R(new S(w));return}if(_=!0,p.size===0){c(E);return}const d=[];for(const[g,m]of E.entries())p.get(g)!==k&&d.push(m);c(d)}return}y++,(async()=>{try{const d=await u.value;if(_)return;const g=await t(d,f);g===k&&p.set(f,g),E[f]=g,y--,await i()}catch(d){if(o)R(d);else{w.push(d),y--;try{await i()}catch(g){R(g)}}}})()},"next");(async()=>{for(let u=0;u<r;u++){try{await i()}catch(f){R(f);break}if(C||T)break}})()})}s(ue,"pMap");const k=Symbol("skip"),j=["assert","count","countReset","debug","dir","dirxml","error","group","groupCollapsed","groupEnd","info","log","table","time","timeEnd","timeLog","trace","warn"];let b={};const fe=s(e=>{const t=new U,r=new U;t.write=n=>{e("stdout",n)},r.write=n=>{e("stderr",n)};const o=new console.Console(t,r);for(const n of j)b[n]=console[n],console[n]=o[n];return()=>{for(const n of j)console[n]=b[n];b={}}},"patchConsole"),H=["\u280B","\u2819","\u2839","\u2838","\u283C","\u2834","\u2826","\u2827","\u2807","\u280F"],l={HIDE_CURSOR:"\x1B[?25l",SHOW_CURSOR:"\x1B[?25h",MOVE_UP:"\x1B[1A",CLEAR_LINE:"\x1B[2K",COLOR_GREEN:"\x1B[32m",COLOR_CYAN:"\x1B[36m",COLOR_RED:"\x1B[31m",COLOR_YELLOW:"\x1B[33m",STYLE_DIM:"\x1B[90m",RESET_FOREGROUND:"\x1B[39m"},L=!!(process.env.CI||process.env.CONTINUOUS_INTEGRATION||process.env.BUILD_NUMBER),pe=s(e=>process.env.NO_COLOR||process.env.NODE_DISABLE_COLORS?!1:e.hasColors?e.hasColors():process.env.FORCE_COLOR!==void 0?process.env.FORCE_COLOR!=="0":e.isTTY!==!1,"detectColors"),O=s((e,t,r)=>e?`${t}${r}${l.RESET_FOREGROUND}`:r,"colorize"),z=s(e=>{for(const t of e)if(t.state==="loading"||t.state==="pending"||t.children&&t.children.length>0&&!z(t.children))return!1;return!0},"areAllTasksDone"),de=s((e,t=process.stdout)=>{let r=0,o,n,c="",a=0,E;const w=t.isTTY!==!1,p=pe(t),T=s((i,u)=>i==="pending"?O(p,l.STYLE_DIM,"\u25FC"):i==="loading"?u?O(p,l.COLOR_YELLOW,"\u276F"):O(p,l.COLOR_CYAN,H[r]):i==="success"?u?O(p,l.COLOR_YELLOW,"\u276F"):O(p,l.COLOR_GREEN,"\u2714"):i==="error"?u?O(p,l.COLOR_RED,"\u276F"):O(p,l.COLOR_RED,"\u2716"):i==="warning"?O(p,l.COLOR_YELLOW,"\u26A0"):O(p,l.STYLE_DIM,"\u25FC"),"getIcon"),_=s((i,u)=>{const f="  ".repeat(u),d=i.children&&i.children.length>0,g=T(i.state,d);let m=`${f}${g} ${i.title}`;if(i.status&&(m+=` [${i.status}]`),m+=`
`,i.output){const F=`\u2192 ${i.output}`,Q=p?`${l.STYLE_DIM}${F}${l.RESET_FOREGROUND}`:F;m+=`${f}  ${Q}
`}return d&&(m+=C(i.children,u+1)),m},"renderTask"),C=s((i,u=0)=>i.map(f=>_(f,u)).join(""),"renderTaskList"),y=s((i,u)=>{if(a>0){for(let f=0;f<a;f+=1)t.write(l.MOVE_UP),t.write(l.CLEAR_LINE);a=0}t.write(u),x()},"handleConsoleOutput"),x=s(()=>{const i=C(e);if(z(e)&&o&&(clearInterval(o),o=void 0),L){i!==c&&(t.write(i),c=i);return}if(a>0)for(let f=0;f<a;f+=1)t.write(l.MOVE_UP),t.write(l.CLEAR_LINE);t.write(i),c=i,a=i.split(`
`).length-1},"render"),I=s(()=>{n||(n=setTimeout(()=>{n=void 0,x()},33))},"scheduleRender"),R=s(()=>{if(o&&clearInterval(o),n&&clearTimeout(n),E&&E(),!L&&w&&a>0)for(let i=0;i<a;i+=1)t.write(l.MOVE_UP),t.write(l.CLEAR_LINE);!L&&w&&t.write(l.SHOW_CURSOR)},"destroy");return!L&&w&&(t.write(l.HIDE_CURSOR),o=setInterval(()=>{r=(r+1)%H.length,I()},80),E=fe(y)),I(),{triggerRender:I,destroy:R}},"createRenderer");let $;const Ee=s(e=>{$=e},"setRenderCallback"),ge=s(e=>new Proxy(e,{set(t,r,o){return Reflect.set(t,r,o),$&&$(),!0}}),"reactive"),D=Symbol("run"),Oe=s(e=>{const t={task:K(e.children),setTitle(r){e.title=r},setStatus(r){e.status=r},setOutput(r){e.output=typeof r=="string"?r:"message"in r?r.message:""},setWarning(r){e.state="warning",r!==void 0&&t.setOutput(r)},setError(r){e.state="error",r!==void 0&&t.setOutput(r)}};return t},"createTaskInnerApi");let h;const q=s((e,t,r)=>{h||(h=de(e),Ee(()=>h.triggerRender()),e.isRoot=!0);const o=ge({title:t,state:"pending",children:[]});return e.push(o),{task:o,[D]:async()=>{const n=Oe(o);o.state="loading";let c;try{c=await r(n)}catch(a){throw n.setError(a),a}return o.state==="loading"&&(o.state="success"),c},clear:s(()=>{const n=e.indexOf(o);n!==-1&&e.splice(n,1),h&&h.triggerRender(),e.isRoot&&e.length===0&&h&&(h.destroy(),h=void 0)},"clear")}},"registerTask");function K(e){const t=s(async(r,o)=>{const n=q(e,r,o);return{result:await n[D](),get state(){return n.task.state},clear:n.clear}},"task");return t.group=(async(r,o)=>{const n=r((a,E)=>q(e,a,E)),c=await ue(n,async a=>({result:await a[D](),get state(){return a.task.state},clear:a.clear}),{concurrency:1,...o});return Object.assign(c,{clear:s(()=>{for(const a of n)a.clear()},"clear")})}),t}s(K,"createTaskFunction");const Re=[];var he=K(Re);export{he as default};
