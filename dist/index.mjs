var ze=Object.defineProperty;var i=(e,t)=>ze(e,"name",{value:t,configurable:!0});import V from"os";import{PassThrough as K}from"stream";import W from"process";import qe from"tty";function He(e,t=1,r={}){const{indent:n=" ",includeEmptyLines:o=!1}=r;if(typeof e!="string")throw new TypeError(`Expected \`input\` to be a \`string\`, got \`${typeof e}\``);if(typeof t!="number")throw new TypeError(`Expected \`count\` to be a \`number\`, got \`${typeof t}\``);if(t<0)throw new RangeError(`Expected \`count\` to be at least 0, got \`${t}\``);if(typeof n!="string")throw new TypeError(`Expected \`options.indent\` to be a \`string\`, got \`${typeof n}\``);if(t===0)return e;const a=o?/^/gm:/^(?!\s*$)/gm;return e.replace(a,n.repeat(t))}i(He,"indentString");function Ve(e){if(typeof e!="string")throw new TypeError("Expected a string");return e.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&").replace(/-/g,"\\x2d")}i(Ve,"escapeStringRegexp");const Q=/\s+at.*[(\s](.*)\)?/,Ke=/^(?:(?:(?:node|node:[\w/]+|(?:(?:node:)?internal\/[\w/]*|.*node_modules\/(?:babel-polyfill|pirates)\/.*)?\w+)(?:\.js)?:\d+:\d+)|native)/,Qe=typeof V.homedir=="undefined"?"":V.homedir().replace(/\\/g,"/");function Je(e,{pretty:t=!1,basePath:r}={}){const n=r&&new RegExp(`(at | \\()${Ve(r.replace(/\\/g,"/"))}`,"g");if(typeof e=="string")return e.replace(/\\/g,"/").split(`
`).filter(o=>{const a=o.match(Q);if(a===null||!a[1])return!0;const l=a[1];return l.includes(".app/Contents/Resources/electron.asar")||l.includes(".app/Contents/Resources/default_app.asar")||l.includes("node_modules/electron/dist/resources/electron.asar")||l.includes("node_modules/electron/dist/resources/default_app.asar")?!1:!Ke.test(l)}).filter(o=>o.trim()!=="").map(o=>(n&&(o=o.replace(n,"$1")),t&&(o=o.replace(Q,(a,l)=>a.replace(l,l.replace(Qe,"~")))),o)).join(`
`)}i(Je,"cleanStack");var Xe=Object.defineProperty,J=i(e=>{throw TypeError(e)},"__typeError"),Ze=i((e,t,r)=>t in e?Xe(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,"__defNormalProp"),et=i((e,t,r)=>Ze(e,t+"",r),"__publicField"),X=i((e,t,r)=>t.has(e)||J("Cannot "+r),"__accessCheck"),tt=i((e,t,r)=>(X(e,t,"read from private field"),r?r.call(e):t.get(e)),"__privateGet"),rt=i((e,t,r)=>t.has(e)?J("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,r),"__privateAdd"),nt=i((e,t,r,n)=>(X(e,t,"write to private field"),t.set(e,r),r),"__privateSet"),O;const ot=i(e=>e.replace(/\s+at .*aggregate-error\/index.js:\d+:\d+\)?/g,""),"cleanInternalStack"),q=class q extends Error{constructor(t){if(!Array.isArray(t))throw new TypeError(`Expected input to be an Array, got ${typeof t}`);t=t.map(n=>n instanceof Error?n:n!==null&&typeof n=="object"?Object.assign(new Error(n.message),n):new Error(n));let r=t.map(n=>typeof n.stack=="string"&&n.stack.length>0?ot(Je(n.stack)):String(n)).join(`
`);r=`
`+He(r,4),super(r),rt(this,O),et(this,"name","AggregateError"),nt(this,O,t)}get errors(){return tt(this,O).slice()}};i(q,"AggregateError");let F=q;O=new WeakMap;const H=class H extends Error{constructor(t){super(),this.name="AbortError",this.message=t}};i(H,"AbortError");let k=H;const Z=i(e=>globalThis.DOMException===void 0?new k(e):new DOMException(e),"getDOMException"),ee=i(e=>{const t=e.reason===void 0?Z("This operation was aborted."):e.reason;return t instanceof Error?t:Z(t)},"getAbortedReason");async function it(e,t,{concurrency:r=Number.POSITIVE_INFINITY,stopOnError:n=!0,signal:o}={}){return new Promise((a,l)=>{if(e[Symbol.iterator]===void 0&&e[Symbol.asyncIterator]===void 0)throw new TypeError(`Expected \`input\` to be either an \`Iterable\` or \`AsyncIterable\`, got (${typeof e})`);if(typeof t!="function")throw new TypeError("Mapper function is required");if(!((Number.isSafeInteger(r)||r===Number.POSITIVE_INFINITY)&&r>=1))throw new TypeError(`Expected \`concurrency\` to be an integer from 1 and up or \`Infinity\`, got \`${r}\` (${typeof r})`);const p=[],f=[],v=new Map;let d=!1,_=!1,S=!1,y=0,R=0;const M=e[Symbol.iterator]===void 0?e[Symbol.asyncIterator]():e[Symbol.iterator](),h=i(s=>{d=!0,_=!0,l(s)},"reject");o&&(o.aborted&&h(ee(o)),o.addEventListener("abort",()=>{h(ee(o))}));const T=i(async()=>{if(_)return;const s=await M.next(),c=R;if(R++,s.done){if(S=!0,y===0&&!_){if(!n&&f.length>0){h(new F(f));return}if(_=!0,v.size===0){a(p);return}const u=[];for(const[g,D]of p.entries())v.get(g)!==te&&u.push(D);a(u)}return}y++,(async()=>{try{const u=await s.value;if(_)return;const g=await t(u,c);g===te&&v.set(c,g),p[c]=g,y--,await T()}catch(u){if(n)h(u);else{f.push(u),y--;try{await T()}catch(g){h(g)}}}})()},"next");(async()=>{for(let s=0;s<r;s++){try{await T()}catch(c){h(c);break}if(S||d)break}})()})}i(it,"pMap");const te=Symbol("skip"),re=["assert","count","countReset","debug","dir","dirxml","error","group","groupCollapsed","groupEnd","info","log","table","time","timeEnd","timeLog","trace","warn"];let G={};const st=i(e=>{const t=new K,r=new K;t.write=o=>{e("stdout",o)},r.write=o=>{e("stderr",o)};const n=new console.Console(t,r);for(const o of re)G[o]=console[o],console[o]=n[o];return()=>{for(const o of re)console[o]=G[o];G={}}},"patchConsole");var ne,oe,ie,se,le,ae,ce,ue,de,pe,fe,ge,ve,he,we,me,_e,ye,Te,be,xe,Ee,Ce,Ie,Se,Re,Oe,$e,Ae,Ne,Me;const B=((ne=globalThis.window)==null?void 0:ne.document)!==void 0;(ie=(oe=globalThis.process)==null?void 0:oe.versions)==null||ie.node,(le=(se=globalThis.process)==null?void 0:se.versions)==null||le.bun,(ce=(ae=globalThis.Deno)==null?void 0:ae.version)==null||ce.deno,(de=(ue=globalThis.process)==null?void 0:ue.versions)==null||de.electron,(fe=(pe=globalThis.navigator)==null?void 0:pe.userAgent)==null||fe.includes("jsdom"),typeof WorkerGlobalScope!="undefined"&&globalThis instanceof WorkerGlobalScope,typeof DedicatedWorkerGlobalScope!="undefined"&&globalThis instanceof DedicatedWorkerGlobalScope,typeof SharedWorkerGlobalScope!="undefined"&&globalThis instanceof SharedWorkerGlobalScope,typeof ServiceWorkerGlobalScope!="undefined"&&globalThis instanceof ServiceWorkerGlobalScope;const E=(ve=(ge=globalThis.navigator)==null?void 0:ge.userAgentData)==null?void 0:ve.platform;E==="macOS"||((he=globalThis.navigator)==null?void 0:he.platform)==="MacIntel"||((me=(we=globalThis.navigator)==null?void 0:we.userAgent)==null?void 0:me.includes(" Mac "))===!0||((_e=globalThis.process)==null||_e.platform),E==="Windows"||((ye=globalThis.navigator)==null?void 0:ye.platform)==="Win32"||((Te=globalThis.process)==null||Te.platform),E==="Linux"||((xe=(be=globalThis.navigator)==null?void 0:be.platform)==null?void 0:xe.startsWith("Linux"))===!0||((Ce=(Ee=globalThis.navigator)==null?void 0:Ee.userAgent)==null?void 0:Ce.includes(" Linux "))===!0||((Ie=globalThis.process)==null||Ie.platform),E==="iOS"||((Se=globalThis.navigator)==null?void 0:Se.platform)==="MacIntel"&&((Re=globalThis.navigator)==null?void 0:Re.maxTouchPoints)>1||/iPad|iPhone|iPod/.test((Oe=globalThis.navigator)==null?void 0:Oe.platform),E==="Android"||(($e=globalThis.navigator)==null?void 0:$e.platform)==="Android"||((Ne=(Ae=globalThis.navigator)==null?void 0:Ae.userAgent)==null?void 0:Ne.includes(" Android "))===!0||((Me=globalThis.process)==null||Me.platform);const $="\x1B[";!B&&W.env.TERM_PROGRAM,!B&&W.platform,B||W.cwd;const j=i((e=1)=>$+e+"A","cursorUp"),lt=$+"?25l",at=$+"?25h",C=$+"2K";var De,Pe,L,We,Fe;const ct=(Fe=(We=(L=(Pe=(De=qe)==null?void 0:De.WriteStream)==null?void 0:Pe.prototype)==null?void 0:L.hasColors)==null?void 0:We.call(L))!=null?Fe:!1,I=i((e,t)=>{if(!ct)return o=>o;const r=`\x1B[${e}m`,n=`\x1B[${t}m`;return o=>{const a=o+"";let l=a.indexOf(n);if(l===-1)return r+a+n;let p=r,f=0;const d=(t===22?n:"")+r;for(;l!==-1;)p+=a.slice(f,l)+d,f=l+n.length,l=a.indexOf(n,f);return p+=a.slice(f)+n,p}},"format"),ut=I(2,22),ke=I(31,39),dt=I(32,39),A=I(33,39),U=I(90,39),Ge=["\u280B","\u2819","\u2839","\u2838","\u283C","\u2834","\u2826","\u2827","\u2807","\u280F"],N=!!(process.env.CI||process.env.CONTINUOUS_INTEGRATION||process.env.BUILD_NUMBER),pt=i(e=>process.env.NO_COLOR||process.env.NODE_DISABLE_COLORS?!1:e.hasColors?e.hasColors():process.env.FORCE_COLOR!==void 0?process.env.FORCE_COLOR!=="0":e.isTTY!==!1,"detectColors"),w=i((e,t,r)=>e?t(r):r,"colorize"),Be=i(e=>{for(const t of e)if(t.state==="loading"||t.state==="pending"||t.children&&t.children.length>0&&!Be(t.children))return!1;return!0},"areAllTasksDone"),ft=i((e,t=process.stdout)=>{let r=0,n,o,a="",l=0,p,f=!1;const v=t.isTTY!==!1,d=pt(t),_=i((s,c)=>s==="pending"?w(d,U,"\u25FC"):s==="loading"?c?w(d,A,"\u276F"):w(d,A,Ge[r]):s==="success"?c?w(d,A,"\u276F"):w(d,dt,"\u2714"):s==="error"?c?w(d,ke,"\u276F"):w(d,ke,"\u2716"):s==="warning"?w(d,A,"\u26A0"):w(d,U,"\u25FC"),"getIcon"),S=i((s,c)=>{const u="  ".repeat(c),g=s.children&&s.children.length>0,D=_(s.state,g);let b=`${u}${D} ${s.title}`;if(s.status){const P=d?ut(`[${s.status}]`):`[${s.status}]`;b+=` ${P}`}if(b+=`
`,s.output){const P=`${u}  `,Ue=i(x=>d?U(x):x,"styleText");b+=`${s.output.split(`
`).map((x,Ye)=>`${P}${Ue(Ye===0?`\u2192 ${x}`:x)}`).join(`
`)}
`}return g&&(b+=y(s.children,c+1)),b},"renderTask"),y=i((s,c=0)=>s.map(u=>S(u,c)).join(""),"renderTaskList"),R=i((s,c)=>{if(l>0){for(let u=0;u<l;u+=1)t.write(C),t.write(j());t.write(C),t.write("\x1B[G"),l=0}t.write(c),e.length>0&&(t.write(`
`),a=`
`,l=1)},"handleConsoleOutput"),M=i(()=>{const s=y(e),c=Be(e);if(c&&n&&(clearInterval(n),n=void 0),N){s!==a&&(t.write(s),a=s);return}if(!f&&v&&s!==""&&s!==`
`&&!c&&(t.write(lt),f=!0),l>0){for(let u=0;u<l;u+=1)t.write(C),t.write(j());t.write(C),t.write("\x1B[G")}t.write(s),a=s,l=s.split(`
`).length-1},"render"),h=i(()=>{o||(o=setTimeout(()=>{o=void 0,M()},33))},"scheduleRender"),T=i(()=>{if(n&&clearInterval(n),o&&clearTimeout(o),p&&p(),!N&&v&&l>0)for(let s=0;s<l;s+=1)t.write(C),t.write(j());!N&&v&&t.write(at)},"destroy");return!N&&v&&(n=setInterval(()=>{r=(r+1)%Ge.length,h()},80),p=st(R)),{triggerRender:h,destroy:T}},"createRenderer");let Y;const gt=i(e=>{Y=e},"setRenderCallback"),vt=i(e=>new Proxy(e,{set(t,r,n){return Reflect.set(t,r,n),Y&&Y(),!0}}),"reactive"),z=Symbol("run"),ht=i(e=>{const t={task:Le(e.children),setTitle(r){e.title=r},setStatus(r){e.status=r},setOutput(r){e.output=typeof r=="string"?r:"message"in r?r.message:""},setWarning(r){e.state="warning",r!==void 0&&t.setOutput(r)},setError(r){e.state="error",r!==void 0&&t.setOutput(r)}};return t},"createTaskInnerApi");let m;const je=i((e,t,r)=>{m||(m=ft(e),gt(()=>m.triggerRender()),e.isRoot=!0);const n=vt({title:t,state:"pending",children:[]});return e.push(n),{task:n,[z]:async()=>{const o=ht(n);n.state="loading";let a;try{a=await r(o)}catch(l){throw o.setError(l),l}return n.state==="loading"&&(n.state="success"),a},clear:i(()=>{const o=e.indexOf(n);o!==-1&&e.splice(o,1),m&&m.triggerRender(),e.isRoot&&e.length===0&&m&&(m.destroy(),m=void 0)},"clear")}},"registerTask");function Le(e){const t=i(async(r,n)=>{const o=je(e,r,n);return{result:await o[z](),get state(){return o.task.state},clear:o.clear}},"task");return t.group=(async(r,n)=>{const o=r((l,p)=>je(e,l,p)),a=await it(o,async l=>({result:await l[z](),get state(){return l.task.state},clear:l.clear}),{concurrency:1,...n});return Object.assign(a,{clear:i(()=>{for(const l of o)l.clear()},"clear")})}),t}i(Le,"createTaskFunction");const wt=[];var mt=Le(wt);export{mt as default};
