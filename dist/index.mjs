var ht=Object.defineProperty;var s=(e,t)=>ht(e,"name",{value:t,configurable:!0});import{PassThrough as ge,Writable as mt}from"stream";import Z from"os";import wt from"tty";import D from"process";function Tt(e,t=1,r={}){const{indent:o=" ",includeEmptyLines:n=!1}=r;if(typeof e!="string")throw new TypeError(`Expected \`input\` to be a \`string\`, got \`${typeof e}\``);if(typeof t!="number")throw new TypeError(`Expected \`count\` to be a \`number\`, got \`${typeof t}\``);if(t<0)throw new RangeError(`Expected \`count\` to be at least 0, got \`${t}\``);if(typeof o!="string")throw new TypeError(`Expected \`options.indent\` to be a \`string\`, got \`${typeof o}\``);if(t===0)return e;const i=n?/^/gm:/^(?!\s*$)/gm;return e.replace(i,o.repeat(t))}s(Tt,"indentString");function yt(e){if(typeof e!="string")throw new TypeError("Expected a string");return e.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&").replace(/-/g,"\\x2d")}s(yt,"escapeStringRegexp");const ve=/\s+at.*[(\s](.*)\)?/,bt=/^(?:(?:(?:node|node:[\w/]+|(?:(?:node:)?internal\/[\w/]*|.*node_modules\/(?:babel-polyfill|pirates)\/.*)?\w+)(?:\.js)?:\d+:\d+)|native)/,_t=typeof Z.homedir=="undefined"?"":Z.homedir().replace(/\\/g,"/");function xt(e,{pretty:t=!1,basePath:r}={}){const o=r&&new RegExp(`(at | \\()${yt(r.replace(/\\/g,"/"))}`,"g");if(typeof e=="string")return e.replace(/\\/g,"/").split(`
`).filter(n=>{const i=n.match(ve);if(i===null||!i[1])return!0;const a=i[1];return a.includes(".app/Contents/Resources/electron.asar")||a.includes(".app/Contents/Resources/default_app.asar")||a.includes("node_modules/electron/dist/resources/electron.asar")||a.includes("node_modules/electron/dist/resources/default_app.asar")?!1:!bt.test(a)}).filter(n=>n.trim()!=="").map(n=>(o&&(n=n.replace(o,"$1")),t&&(n=n.replace(ve,(i,a)=>i.replace(a,a.replace(_t,"~")))),n)).join(`
`)}s(xt,"cleanStack");var $t=Object.defineProperty,he=s(e=>{throw TypeError(e)},"__typeError"),Et=s((e,t,r)=>t in e?$t(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,"__defNormalProp"),Rt=s((e,t,r)=>Et(e,t+"",r),"__publicField"),me=s((e,t,r)=>t.has(e)||he("Cannot "+r),"__accessCheck"),Ct=s((e,t,r)=>(me(e,t,"read from private field"),r?r.call(e):t.get(e)),"__privateGet"),It=s((e,t,r)=>t.has(e)?he("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,r),"__privateAdd"),Ot=s((e,t,r,o)=>(me(e,t,"write to private field"),t.set(e,r),r),"__privateSet"),J;const St=s(e=>e.replace(/\s+at .*aggregate-error\/index.js:\d+:\d+\)?/g,""),"cleanInternalStack"),le=class le extends Error{constructor(t){if(!Array.isArray(t))throw new TypeError(`Expected input to be an Array, got ${typeof t}`);t=t.map(o=>o instanceof Error?o:o!==null&&typeof o=="object"?Object.assign(new Error(o.message),o):new Error(o));let r=t.map(o=>typeof o.stack=="string"&&o.stack.length>0?St(xt(o.stack)):String(o)).join(`
`);r=`
`+Tt(r,4),super(r),It(this,J),Rt(this,"name","AggregateError"),Ot(this,J,t)}get errors(){return Ct(this,J).slice()}};s(le,"AggregateError");let K=le;J=new WeakMap;const ae=class ae extends Error{constructor(t){super(),this.name="AbortError",this.message=t}};s(ae,"AbortError");let ee=ae;const we=s(e=>globalThis.DOMException===void 0?new ee(e):new DOMException(e),"getDOMException"),Te=s(e=>{const t=e.reason===void 0?we("This operation was aborted."):e.reason;return t instanceof Error?t:we(t)},"getAbortedReason");async function Mt(e,t,{concurrency:r=Number.POSITIVE_INFINITY,stopOnError:o=!0,signal:n}={}){return new Promise((i,a)=>{if(e[Symbol.iterator]===void 0&&e[Symbol.asyncIterator]===void 0)throw new TypeError(`Expected \`input\` to be either an \`Iterable\` or \`AsyncIterable\`, got (${typeof e})`);if(typeof t!="function")throw new TypeError("Mapper function is required");if(!((Number.isSafeInteger(r)||r===Number.POSITIVE_INFINITY)&&r>=1))throw new TypeError(`Expected \`concurrency\` to be an integer from 1 and up or \`Infinity\`, got \`${r}\` (${typeof r})`);const c=[],u=[],m=new Map;let f=!1,v=!1,w=!1,_=0,x=0;const F=e[Symbol.iterator]===void 0?e[Symbol.asyncIterator]():e[Symbol.iterator](),I=s(T=>{f=!0,v=!0,a(T)},"reject");n&&(n.aborted&&I(Te(n)),n.addEventListener("abort",()=>{I(Te(n))}));const j=s(async()=>{if(v)return;const T=await F.next(),O=x;if(x++,T.done){if(w=!0,_===0&&!v){if(!o&&u.length>0){I(new K(u));return}if(v=!0,m.size===0){i(c);return}const h=[];for(const[$,Q]of c.entries())m.get($)!==ye&&h.push(Q);i(h)}return}_++,(async()=>{try{const h=await T.value;if(v)return;const $=await t(h,O);$===ye&&m.set(O,$),c[O]=$,_--,await j()}catch(h){if(o)I(h);else{u.push(h),_--;try{await j()}catch($){I($)}}}})()},"next");(async()=>{for(let T=0;T<r;T++){try{await j()}catch(O){I(O);break}if(w||f)break}})()})}s(Mt,"pMap");const ye=Symbol("skip");function At({onlyFirst:e=!1}={}){const n="(?:\\u001B\\][\\s\\S]*?(?:\\u0007|\\u001B\\u005C|\\u009C))|[\\u001B\\u009B][[\\]()#;?]*(?:\\d{1,4}(?:[;:]\\d{0,4})*)?[\\dA-PR-TZcf-nq-uy=><~]";return new RegExp(n,e?void 0:"g")}s(At,"ansiRegex");const Pt=At();function Nt(e){if(typeof e!="string")throw new TypeError(`Expected a \`string\`, got \`${typeof e}\``);return e.replace(Pt,"")}s(Nt,"stripAnsi");const be=["assert","count","countReset","debug","dir","dirxml","error","group","groupCollapsed","groupEnd","info","log","table","time","timeEnd","timeLog","trace","warn"];let te={};const Wt=s(e=>{const t=new ge,r=new ge;t.write=n=>{e("stdout",n)},r.write=n=>{e("stderr",n)};const o=new console.Console(t,r);for(const n of be)te[n]=console[n],console[n]=o[n];return()=>{for(const n of be)console[n]=te[n];te={}}},"patchConsole");var _e,xe,$e,Ee,Re,Ce,Ie,Oe,Se,Me,Ae,Pe,Ne,We,De,Be,Fe,je,Le,Ge,Ve,ze,Ue,Ye,qe,He,Je,ke,Qe,Xe,Ze;const z=((_e=globalThis.window)==null?void 0:_e.document)!==void 0;($e=(xe=globalThis.process)==null?void 0:xe.versions)==null||$e.node,(Re=(Ee=globalThis.process)==null?void 0:Ee.versions)==null||Re.bun,(Ie=(Ce=globalThis.Deno)==null?void 0:Ce.version)==null||Ie.deno,(Se=(Oe=globalThis.process)==null?void 0:Oe.versions)==null||Se.electron,(Ae=(Me=globalThis.navigator)==null?void 0:Me.userAgent)==null||Ae.includes("jsdom"),typeof WorkerGlobalScope!="undefined"&&globalThis instanceof WorkerGlobalScope,typeof DedicatedWorkerGlobalScope!="undefined"&&globalThis instanceof DedicatedWorkerGlobalScope,typeof SharedWorkerGlobalScope!="undefined"&&globalThis instanceof SharedWorkerGlobalScope,typeof ServiceWorkerGlobalScope!="undefined"&&globalThis instanceof ServiceWorkerGlobalScope;const U=(Ne=(Pe=globalThis.navigator)==null?void 0:Pe.userAgentData)==null?void 0:Ne.platform;U==="macOS"||((We=globalThis.navigator)==null?void 0:We.platform)==="MacIntel"||((Be=(De=globalThis.navigator)==null?void 0:De.userAgent)==null?void 0:Be.includes(" Mac "))===!0||((Fe=globalThis.process)==null||Fe.platform),U==="Windows"||((je=globalThis.navigator)==null?void 0:je.platform)==="Win32"||((Le=globalThis.process)==null||Le.platform),U==="Linux"||((Ve=(Ge=globalThis.navigator)==null?void 0:Ge.platform)==null?void 0:Ve.startsWith("Linux"))===!0||((Ue=(ze=globalThis.navigator)==null?void 0:ze.userAgent)==null?void 0:Ue.includes(" Linux "))===!0||((Ye=globalThis.process)==null||Ye.platform),U==="iOS"||((qe=globalThis.navigator)==null?void 0:qe.platform)==="MacIntel"&&((He=globalThis.navigator)==null?void 0:He.maxTouchPoints)>1||/iPad|iPhone|iPod/.test((Je=globalThis.navigator)==null?void 0:Je.platform),U==="Android"||((ke=globalThis.navigator)==null?void 0:ke.platform)==="Android"||((Xe=(Qe=globalThis.navigator)==null?void 0:Qe.userAgent)==null?void 0:Xe.includes(" Android "))===!0||((Ze=globalThis.process)==null||Ze.platform);var Ke,et;const P="\x1B[",tt=!z&&D.env.TERM_PROGRAM==="Apple_Terminal",Dt=!z&&D.platform==="win32";!z&&((Ke=D.env.TERM)!=null&&Ke.startsWith("screen")||(et=D.env.TERM)!=null&&et.startsWith("tmux")||D.env.TMUX),z||D.cwd;const Bt=tt?"\x1B7":P+"s",Ft=tt?"\x1B8":P+"u",jt=P+"J",nt=P+"2J",Lt=s(()=>{var e;if(z||!Dt)return!1;const t=Z.release().split("."),r=Number(t[0]),o=Number((e=t[2])!=null?e:0);return r<10||r===10&&o<10586},"isOldWindows");Lt()?`${nt}${P}`:`${nt}${P}${P}`;var rt,ot,ne,st,it;const Gt=(it=(st=(ne=(ot=(rt=wt)==null?void 0:rt.WriteStream)==null?void 0:ot.prototype)==null?void 0:ne.hasColors)==null?void 0:st.call(ne))!=null?it:!1,Y=s((e,t)=>{if(!Gt)return n=>n;const r=`\x1B[${e}m`,o=`\x1B[${t}m`;return n=>{const i=n+"";let a=i.indexOf(o);if(a===-1)return r+i+o;let c=r,u=0;const f=(t===22?o:"")+r;for(;a!==-1;)c+=i.slice(u,a)+f,u=a+o.length,a=i.indexOf(o,u);return c+=i.slice(u)+o,c}},"format"),re=Y(2,22),lt=Y(31,39),Vt=Y(32,39),k=Y(33,39),oe=Y(90,39),at=s(e=>{const t=Math.floor(e/1e3);if(t<60)return`(${t}s)`;const r=Math.floor(t/60);if(r<60){const i=t%60;return`(${r}m ${i}s)`}const o=Math.floor(r/60),n=r%60;return`(${o}h ${n}m)`},"formatElapsed"),B=s(e=>{for(const t of e)if(t.state==="loading"||t.state==="pending"||t.children&&t.children.length>0&&!B(t.children))return!1;return!0},"areAllTasksDone"),ct=["\u280B","\u2819","\u2839","\u2838","\u283C","\u2834","\u2826","\u2827","\u2807","\u280F"],q=!!(process.env.CI||process.env.CONTINUOUS_INTEGRATION||process.env.BUILD_NUMBER),zt=s(e=>process.env.NO_COLOR||process.env.NODE_DISABLE_COLORS?!1:e.hasColors?e.hasColors():process.env.FORCE_COLOR!==void 0?process.env.FORCE_COLOR!=="0":e.isTTY===!0,"detectColors"),C=s((e,t,r)=>e?t(r):r,"colorize"),Ut=s((e,t=process.stdout)=>{let r=0,o,n,i="",a=!1,c=!1,u;const m=t.isTTY===!0,f=zt(t),v=m&&!q,w=s(()=>{q||(t.write(Bt),c=!0)},"savePosition"),_=s(()=>{c&&t.write(Ft+jt)},"clearRenderArea");let x,F=t.rows||24;const I=s(()=>{if(x!==void 0){const l=typeof x=="function"?x(F):x;return Math.max(1,l)}return Math.max(5,F-2)},"getVisibleLinesLimit"),j=s((l,d)=>l==="pending"?C(f,oe,"\u25FC"):l==="loading"?d?C(f,k,"\u276F"):C(f,k,ct[r]):l==="success"?d?C(f,k,"\u276F"):C(f,Vt,"\u2714"):l==="error"?d?C(f,lt,"\u276F"):C(f,lt,"\u2716"):l==="warning"?C(f,k,"\u26A0"):C(f,oe,"\u25FC"),"getIcon"),T=s((l,d)=>{var S;const N="  ".repeat(d),A=l.children&&l.children.length>0,G=j(l.state,A);let y=`${N}${G} ${l.title}`;if(l.status){const p=f?re(`[${l.status}]`):`[${l.status}]`;y+=` ${p}`}const M=(S=l.elapsedMs)!=null?S:l.startedAt===void 0?void 0:Date.now()-l.startedAt;if(M!==void 0&&M>=1e3){const p=f?re(at(M)):at(M);y+=` ${p}`}y+=`
`;const W=`${N}  `,R=s(p=>f?oe(p):p,"styleText");if(l.output&&(y+=`${l.output.split(`
`).map((p,E)=>`${W}${R(E===0?`\u2192 ${p}`:p)}`).join(`
`)}
`),l.streamOutput){const p=`${W}   `;if(y+=`${l.streamOutput.split(`
`).map((E,V)=>V===0?`${W}\u23BF  ${R(E)}`:`${p}${R(E)}`).join(`
`)}
`,l.streamTruncatedLines){const E=`(+ ${l.streamTruncatedLines} lines)`;y+=`${p}${R(E)}
`}}return A&&(y+=$(l.children,d+1)),y},"renderTask"),O=s(l=>l==="loading"?0:l==="pending"?1:2,"getStatePriority");let h=!1;const $=s((l,d=0)=>{if(d===0){if(!(h&&x===void 0)){const N=I(),A=[...l].sort((b,H)=>O(b.state)-O(H.state));let G="",y=0,M=0;for(let b=0;b<A.length;b+=1){const H=T(A[b],d),pe=H.split(`
`).length-1,vt=b<A.length-1?1:0;if(y+pe+vt>N&&M>0)break;G+=H,y+=pe,M+=1}const W=A.slice(M);if(a=W.length>0,!a)return l.map(b=>T(b,d)).join("");const R=[];let p=0,E=0,V=0;for(const b of W)b.state==="loading"?p+=1:b.state==="pending"?E+=1:V+=1;p>0&&R.push(`${p} loading`),E>0&&R.push(`${E} queued`),V>0&&R.push(`${V} completed`);const fe=`(+ ${R.join(", ")})`,gt=f?re(fe):fe;return G+=`${gt}
`,G}return a=!1,l.map(N=>T(N,d)).join("")}return l.map(S=>T(S,d)).join("")},"renderTaskList"),Q=s((l,d)=>{_(),t.write(d),w(),e.length>0&&(B(e)&&i!==`
`?L():(t.write(`
`),i=`
`))},"handleConsoleOutput"),ce=s(()=>{o||!m||q||(o=setInterval(()=>{r=(r+1)%ct.length,X()},80),o.unref())},"startSpinner"),L=s((l=!1)=>{const d=$(e),S=B(e);if(S&&o?(clearInterval(o),o=void 0):!S&&!o&&ce(),q&&!l){B(e)&&d!==i&&(t.write(d),i=d);return}_(),c||w(),t.write(d),i=d},"render"),X=s(()=>{n||(n=setTimeout(()=>{n=void 0,L()},33))},"scheduleRender"),ft=s(()=>{v&&(n&&(clearTimeout(n),n=void 0),L(),B(e)&&a&&(i=`
`))},"flushRender"),ue=s(()=>{F=t.rows||24,X()},"handleResize"),pt=s(()=>{v&&process.off("exit",de),m&&t.off("resize",ue),o&&clearInterval(o),n&&clearTimeout(n),u&&u(),_(),c=!1},"destroy"),de=s(()=>{a&&B(e)&&(x=void 0,h=!0,L(),h=!1)},"handleExit");return m&&t.on("resize",ue),v&&process.on("exit",de),q||(u=Wt(Q),ce()),{triggerRender:X,flushRender:ft,renderFinal:s(()=>{h=!0,L(!0),h=!1},"renderFinal"),destroy:pt,setMaxVisible:s(l=>{x=l},"setMaxVisible")}},"createRenderer");let se;const Yt=s(e=>{se=e},"setRenderCallback"),qt=s(e=>new Proxy(e,{set(t,r,o){return Reflect.set(t,r,o),se&&se(),!0}}),"reactive"),ie=Symbol("run"),Ht=5,Jt=s((e,t)=>{const r=[];let o=0,n="";const i=s(c=>{var u;return(u=c.split("\r").reverse().find(Boolean))!=null?u:""},"resolveCarriageReturn"),a=s(()=>{const c=n.includes("\r")?i(n):n,u=c?[...r,c].join(`
`):r.join(`
`);e.streamOutput=u,e.streamTruncatedLines=Math.max(0,o-t)},"flush");return new mt({write(c,u,m){const v=Nt(n+c.toString()).split(/\r?\n/);n=v.pop();for(const w of v){const _=w.includes("\r")?i(w):w;r.push(_),o+=1,r.length>t&&r.shift()}if(n.includes("\r")){const w=i(n);n=n.endsWith("\r")?`${w}\r`:w}(v.length>0||n)&&a(),m()},final(c){if(n){const u=n.includes("\r")?i(n):n;r.push(u),o+=1,r.length>t&&r.shift(),n="",a()}c()}})},"createStreamPreview"),kt=s((e,t)=>{let r;const o={task:dt(e.children),setTitle(n){e.title=n},setStatus(n){e.status=n},setOutput(n){e.output=typeof n=="string"?n:"message"in n?n.message:""},get streamPreview(){var n;return r||(r=Jt(e,Math.max(1,Math.trunc((n=t==null?void 0:t.previewLines)!=null?n:Ht)))),r},setWarning(n){e.state="warning",n!==void 0&&o.setOutput(n)},setError(n){e.state="error",n!==void 0&&o.setOutput(n)},startTime:s(()=>{e.startedAt=Date.now(),e.elapsedMs=void 0},"startTime"),stopTime:s(()=>e.startedAt===void 0?0:(e.elapsedMs=Date.now()-e.startedAt,e.startedAt=void 0,e.elapsedMs),"stopTime")};return{api:o,destroyStream:s(()=>r==null?void 0:r.destroy(),"destroyStream")}},"createTaskInnerApi");let g;const ut=s((e,t,r,o)=>{g||(g=Ut(e),Yt(()=>g.triggerRender()),e.isRoot=!0);const n=qt({title:t,state:"pending",children:[]});return e.push(n),{task:n,[ie]:async()=>{const{api:i,destroyStream:a}=kt(n,o);n.state="loading",o!=null&&o.showTime&&i.startTime();let c;try{c=await r(i)}catch(u){throw i.stopTime(),i.setError(u),a(),g==null||g.flushRender(),u}return i.stopTime(),a(),n.state==="loading"&&(n.state="success"),g==null||g.flushRender(),c},clear:s(()=>{const i=e.indexOf(n);i!==-1&&e.splice(i,1),g&&(e.isRoot&&e.length===0?(g.renderFinal(),g.destroy(),g=void 0):g.triggerRender())},"clear")}},"registerTask");function dt(e){const t=s(async(r,o,n)=>{const i=ut(e,r,o,n);return{result:await i[ie](),get state(){return i.task.state},clear:i.clear}},"task");return t.group=(async(r,o)=>{const n=r((a,c)=>ut(e,a,c));(o==null?void 0:o.maxVisible)!==void 0&&g&&g.setMaxVisible(o.maxVisible);const i=await Mt(n,async a=>({result:await a[ie](),get state(){return a.task.state},clear:a.clear}),{concurrency:1,...o});return Object.assign(i,{clear:s(()=>{for(const a of n)a.clear();(o==null?void 0:o.maxVisible)!==void 0&&g&&g.setMaxVisible(void 0)},"clear")})}),t}s(dt,"createTaskFunction");const Qt=[];var Xt=dt(Qt);export{Xt as default};
