"use strict";var ht=Object.defineProperty;var s=(e,t)=>ht(e,"name",{value:t,configurable:!0});var Z=require("stream"),K=require("os"),mt=require("tty"),D=require("process");function Tt(e,t=1,r={}){const{indent:o=" ",includeEmptyLines:n=!1}=r;if(typeof e!="string")throw new TypeError(`Expected \`input\` to be a \`string\`, got \`${typeof e}\``);if(typeof t!="number")throw new TypeError(`Expected \`count\` to be a \`number\`, got \`${typeof t}\``);if(t<0)throw new RangeError(`Expected \`count\` to be at least 0, got \`${t}\``);if(typeof o!="string")throw new TypeError(`Expected \`options.indent\` to be a \`string\`, got \`${typeof o}\``);if(t===0)return e;const i=n?/^/gm:/^(?!\s*$)/gm;return e.replace(i,o.repeat(t))}s(Tt,"indentString");function wt(e){if(typeof e!="string")throw new TypeError("Expected a string");return e.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&").replace(/-/g,"\\x2d")}s(wt,"escapeStringRegexp");const ve=/\s+at.*[(\s](.*)\)?/,yt=/^(?:(?:(?:node|node:[\w/]+|(?:(?:node:)?internal\/[\w/]*|.*node_modules\/(?:babel-polyfill|pirates)\/.*)?\w+)(?:\.js)?:\d+:\d+)|native)/,bt=typeof K.homedir=="undefined"?"":K.homedir().replace(/\\/g,"/");function _t(e,{pretty:t=!1,basePath:r}={}){const o=r&&new RegExp(`(at | \\()${wt(r.replace(/\\/g,"/"))}`,"g");if(typeof e=="string")return e.replace(/\\/g,"/").split(`
`).filter(n=>{const i=n.match(ve);if(i===null||!i[1])return!0;const a=i[1];return a.includes(".app/Contents/Resources/electron.asar")||a.includes(".app/Contents/Resources/default_app.asar")||a.includes("node_modules/electron/dist/resources/electron.asar")||a.includes("node_modules/electron/dist/resources/default_app.asar")?!1:!yt.test(a)}).filter(n=>n.trim()!=="").map(n=>(o&&(n=n.replace(o,"$1")),t&&(n=n.replace(ve,(i,a)=>i.replace(a,a.replace(bt,"~")))),n)).join(`
`)}s(_t,"cleanStack");var xt=Object.defineProperty,he=s(e=>{throw TypeError(e)},"__typeError"),$t=s((e,t,r)=>t in e?xt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,"__defNormalProp"),Et=s((e,t,r)=>$t(e,t+"",r),"__publicField"),me=s((e,t,r)=>t.has(e)||he("Cannot "+r),"__accessCheck"),Rt=s((e,t,r)=>(me(e,t,"read from private field"),r?r.call(e):t.get(e)),"__privateGet"),Ct=s((e,t,r)=>t.has(e)?he("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,r),"__privateAdd"),It=s((e,t,r,o)=>(me(e,t,"write to private field"),t.set(e,r),r),"__privateSet"),J;const Ot=s(e=>e.replace(/\s+at .*aggregate-error\/index.js:\d+:\d+\)?/g,""),"cleanInternalStack"),ae=class ae extends Error{constructor(t){if(!Array.isArray(t))throw new TypeError(`Expected input to be an Array, got ${typeof t}`);t=t.map(o=>o instanceof Error?o:o!==null&&typeof o=="object"?Object.assign(new Error(o.message),o):new Error(o));let r=t.map(o=>typeof o.stack=="string"&&o.stack.length>0?Ot(_t(o.stack)):String(o)).join(`
`);r=`
`+Tt(r,4),super(r),Ct(this,J),Et(this,"name","AggregateError"),It(this,J,t)}get errors(){return Rt(this,J).slice()}};s(ae,"AggregateError");let ee=ae;J=new WeakMap;const ce=class ce extends Error{constructor(t){super(),this.name="AbortError",this.message=t}};s(ce,"AbortError");let te=ce;const Te=s(e=>globalThis.DOMException===void 0?new te(e):new DOMException(e),"getDOMException"),we=s(e=>{const t=e.reason===void 0?Te("This operation was aborted."):e.reason;return t instanceof Error?t:Te(t)},"getAbortedReason");async function St(e,t,{concurrency:r=Number.POSITIVE_INFINITY,stopOnError:o=!0,signal:n}={}){return new Promise((i,a)=>{if(e[Symbol.iterator]===void 0&&e[Symbol.asyncIterator]===void 0)throw new TypeError(`Expected \`input\` to be either an \`Iterable\` or \`AsyncIterable\`, got (${typeof e})`);if(typeof t!="function")throw new TypeError("Mapper function is required");if(!((Number.isSafeInteger(r)||r===Number.POSITIVE_INFINITY)&&r>=1))throw new TypeError(`Expected \`concurrency\` to be an integer from 1 and up or \`Infinity\`, got \`${r}\` (${typeof r})`);const c=[],u=[],m=new Map;let f=!1,v=!1,T=!1,_=0,x=0;const F=e[Symbol.iterator]===void 0?e[Symbol.asyncIterator]():e[Symbol.iterator](),I=s(w=>{f=!0,v=!0,a(w)},"reject");n&&(n.aborted&&I(we(n)),n.addEventListener("abort",()=>{I(we(n))}));const j=s(async()=>{if(v)return;const w=await F.next(),O=x;if(x++,w.done){if(T=!0,_===0&&!v){if(!o&&u.length>0){I(new ee(u));return}if(v=!0,m.size===0){i(c);return}const h=[];for(const[$,Q]of c.entries())m.get($)!==ye&&h.push(Q);i(h)}return}_++,(async()=>{try{const h=await w.value;if(v)return;const $=await t(h,O);$===ye&&m.set(O,$),c[O]=$,_--,await j()}catch(h){if(o)I(h);else{u.push(h),_--;try{await j()}catch($){I($)}}}})()},"next");(async()=>{for(let w=0;w<r;w++){try{await j()}catch(O){I(O);break}if(T||f)break}})()})}s(St,"pMap");const ye=Symbol("skip");function Mt({onlyFirst:e=!1}={}){const n="(?:\\u001B\\][\\s\\S]*?(?:\\u0007|\\u001B\\u005C|\\u009C))|[\\u001B\\u009B][[\\]()#;?]*(?:\\d{1,4}(?:[;:]\\d{0,4})*)?[\\dA-PR-TZcf-nq-uy=><~]";return new RegExp(n,e?void 0:"g")}s(Mt,"ansiRegex");const At=Mt();function Pt(e){if(typeof e!="string")throw new TypeError(`Expected a \`string\`, got \`${typeof e}\``);return e.replace(At,"")}s(Pt,"stripAnsi");const be=["assert","count","countReset","debug","dir","dirxml","error","group","groupCollapsed","groupEnd","info","log","table","time","timeEnd","timeLog","trace","warn"];let ne={};const Nt=s(e=>{const t=new Z.PassThrough,r=new Z.PassThrough;t.write=n=>{e("stdout",n)},r.write=n=>{e("stderr",n)};const o=new console.Console(t,r);for(const n of be)ne[n]=console[n],console[n]=o[n];return()=>{for(const n of be)console[n]=ne[n];ne={}}},"patchConsole");var _e,xe,$e,Ee,Re,Ce,Ie,Oe,Se,Me,Ae,Pe,Ne,We,De,Be,Fe,je,Le,Ge,Ve,qe,ze,Ue,Ye,He,Je,ke,Qe,Xe,Ze;const q=((_e=globalThis.window)==null?void 0:_e.document)!==void 0;($e=(xe=globalThis.process)==null?void 0:xe.versions)==null||$e.node,(Re=(Ee=globalThis.process)==null?void 0:Ee.versions)==null||Re.bun,(Ie=(Ce=globalThis.Deno)==null?void 0:Ce.version)==null||Ie.deno,(Se=(Oe=globalThis.process)==null?void 0:Oe.versions)==null||Se.electron,(Ae=(Me=globalThis.navigator)==null?void 0:Me.userAgent)==null||Ae.includes("jsdom"),typeof WorkerGlobalScope!="undefined"&&globalThis instanceof WorkerGlobalScope,typeof DedicatedWorkerGlobalScope!="undefined"&&globalThis instanceof DedicatedWorkerGlobalScope,typeof SharedWorkerGlobalScope!="undefined"&&globalThis instanceof SharedWorkerGlobalScope,typeof ServiceWorkerGlobalScope!="undefined"&&globalThis instanceof ServiceWorkerGlobalScope;const z=(Ne=(Pe=globalThis.navigator)==null?void 0:Pe.userAgentData)==null?void 0:Ne.platform;z==="macOS"||((We=globalThis.navigator)==null?void 0:We.platform)==="MacIntel"||((Be=(De=globalThis.navigator)==null?void 0:De.userAgent)==null?void 0:Be.includes(" Mac "))===!0||((Fe=globalThis.process)==null||Fe.platform),z==="Windows"||((je=globalThis.navigator)==null?void 0:je.platform)==="Win32"||((Le=globalThis.process)==null||Le.platform),z==="Linux"||((Ve=(Ge=globalThis.navigator)==null?void 0:Ge.platform)==null?void 0:Ve.startsWith("Linux"))===!0||((ze=(qe=globalThis.navigator)==null?void 0:qe.userAgent)==null?void 0:ze.includes(" Linux "))===!0||((Ue=globalThis.process)==null||Ue.platform),z==="iOS"||((Ye=globalThis.navigator)==null?void 0:Ye.platform)==="MacIntel"&&((He=globalThis.navigator)==null?void 0:He.maxTouchPoints)>1||/iPad|iPhone|iPod/.test((Je=globalThis.navigator)==null?void 0:Je.platform),z==="Android"||((ke=globalThis.navigator)==null?void 0:ke.platform)==="Android"||((Xe=(Qe=globalThis.navigator)==null?void 0:Qe.userAgent)==null?void 0:Xe.includes(" Android "))===!0||((Ze=globalThis.process)==null||Ze.platform);var Ke,et;const P="\x1B[",tt=!q&&D.env.TERM_PROGRAM==="Apple_Terminal",Wt=!q&&D.platform==="win32";!q&&((Ke=D.env.TERM)!=null&&Ke.startsWith("screen")||(et=D.env.TERM)!=null&&et.startsWith("tmux")||D.env.TMUX),q||D.cwd;const Dt=tt?"\x1B7":P+"s",Bt=tt?"\x1B8":P+"u",Ft=P+"J",nt=P+"2J",jt=s(()=>{var e;if(q||!Wt)return!1;const t=K.release().split("."),r=Number(t[0]),o=Number((e=t[2])!=null?e:0);return r<10||r===10&&o<10586},"isOldWindows");jt()?`${nt}${P}`:`${nt}${P}${P}`;var rt,ot,re,st,it;const Lt=(it=(st=(re=(ot=(rt=mt)==null?void 0:rt.WriteStream)==null?void 0:ot.prototype)==null?void 0:re.hasColors)==null?void 0:st.call(re))!=null?it:!1,U=s((e,t)=>{if(!Lt)return n=>n;const r=`\x1B[${e}m`,o=`\x1B[${t}m`;return n=>{const i=n+"";let a=i.indexOf(o);if(a===-1)return r+i+o;let c=r,u=0;const f=(t===22?o:"")+r;for(;a!==-1;)c+=i.slice(u,a)+f,u=a+o.length,a=i.indexOf(o,u);return c+=i.slice(u)+o,c}},"format"),oe=U(2,22),lt=U(31,39),Gt=U(32,39),k=U(33,39),se=U(90,39),at=s(e=>{const t=Math.floor(e/1e3);if(t<60)return`(${t}s)`;const r=Math.floor(t/60);if(r<60){const i=t%60;return`(${r}m ${i}s)`}const o=Math.floor(r/60),n=r%60;return`(${o}h ${n}m)`},"formatElapsed"),B=s(e=>{for(const t of e)if(t.state==="loading"||t.state==="pending"||t.children&&t.children.length>0&&!B(t.children))return!1;return!0},"areAllTasksDone"),ct=["\u280B","\u2819","\u2839","\u2838","\u283C","\u2834","\u2826","\u2827","\u2807","\u280F"],Y=!!(process.env.CI||process.env.CONTINUOUS_INTEGRATION||process.env.BUILD_NUMBER),Vt=s(e=>process.env.NO_COLOR||process.env.NODE_DISABLE_COLORS?!1:e.hasColors?e.hasColors():process.env.FORCE_COLOR!==void 0?process.env.FORCE_COLOR!=="0":e.isTTY===!0,"detectColors"),C=s((e,t,r)=>e?t(r):r,"colorize"),qt=s((e,t=process.stdout)=>{let r=0,o,n,i="",a=!1,c=!1,u;const m=t.isTTY===!0,f=Vt(t),v=m&&!Y,T=s(()=>{Y||(t.write(Dt),c=!0)},"savePosition"),_=s(()=>{c&&t.write(Bt+Ft)},"clearRenderArea");let x,F=t.rows||24;const I=s(()=>{if(x!==void 0){const l=typeof x=="function"?x(F):x;return Math.max(1,l)}return Math.max(5,F-2)},"getVisibleLinesLimit"),j=s((l,d)=>l==="pending"?C(f,se,"\u25FC"):l==="loading"?d?C(f,k,"\u276F"):C(f,k,ct[r]):l==="success"?d?C(f,k,"\u276F"):C(f,Gt,"\u2714"):l==="error"?d?C(f,lt,"\u276F"):C(f,lt,"\u2716"):l==="warning"?C(f,k,"\u26A0"):C(f,se,"\u25FC"),"getIcon"),w=s((l,d)=>{var S;const N="  ".repeat(d),A=l.children&&l.children.length>0,G=j(l.state,A);let y=`${N}${G} ${l.title}`;if(l.status){const p=f?oe(`[${l.status}]`):`[${l.status}]`;y+=` ${p}`}const M=(S=l.elapsedMs)!=null?S:l.startedAt===void 0?void 0:Date.now()-l.startedAt;if(M!==void 0&&M>=1e3){const p=f?oe(at(M)):at(M);y+=` ${p}`}y+=`
`;const W=`${N}  `,R=s(p=>f?se(p):p,"styleText");if(l.output&&(y+=`${l.output.split(`
`).map((p,E)=>`${W}${R(E===0?`\u2192 ${p}`:p)}`).join(`
`)}
`),l.streamOutput){const p=`${W}   `;if(y+=`${l.streamOutput.split(`
`).map((E,V)=>V===0?`${W}\u23BF  ${R(E)}`:`${p}${R(E)}`).join(`
`)}
`,l.streamTruncatedLines){const E=`(+ ${l.streamTruncatedLines} lines)`;y+=`${p}${R(E)}
`}}return A&&(y+=$(l.children,d+1)),y},"renderTask"),O=s(l=>l==="loading"?0:l==="pending"?1:2,"getStatePriority");let h=!1;const $=s((l,d=0)=>{if(d===0){if(!(h&&x===void 0)){const N=I(),A=[...l].sort((b,H)=>O(b.state)-O(H.state));let G="",y=0,M=0;for(let b=0;b<A.length;b+=1){const H=w(A[b],d),ge=H.split(`
`).length-1,vt=b<A.length-1?1:0;if(y+ge+vt>N&&M>0)break;G+=H,y+=ge,M+=1}const W=A.slice(M);if(a=W.length>0,!a)return l.map(b=>w(b,d)).join("");const R=[];let p=0,E=0,V=0;for(const b of W)b.state==="loading"?p+=1:b.state==="pending"?E+=1:V+=1;p>0&&R.push(`${p} loading`),E>0&&R.push(`${E} queued`),V>0&&R.push(`${V} completed`);const pe=`(+ ${R.join(", ")})`,gt=f?oe(pe):pe;return G+=`${gt}
`,G}return a=!1,l.map(N=>w(N,d)).join("")}return l.map(S=>w(S,d)).join("")},"renderTaskList"),Q=s((l,d)=>{_(),t.write(d),T(),e.length>0&&(B(e)&&i!==`
`?L():(t.write(`
`),i=`
`))},"handleConsoleOutput"),ue=s(()=>{o||!m||Y||(o=setInterval(()=>{r=(r+1)%ct.length,X()},80),o.unref())},"startSpinner"),L=s((l=!1)=>{const d=$(e),S=B(e);if(S&&o?(clearInterval(o),o=void 0):!S&&!o&&ue(),Y&&!l){B(e)&&d!==i&&(t.write(d),i=d);return}_(),c||T(),t.write(d),i=d},"render"),X=s(()=>{n||(n=setTimeout(()=>{n=void 0,L()},33))},"scheduleRender"),ft=s(()=>{v&&(n&&(clearTimeout(n),n=void 0),L(),B(e)&&a&&(i=`
`))},"flushRender"),de=s(()=>{F=t.rows||24,X()},"handleResize"),pt=s(()=>{v&&process.off("exit",fe),m&&t.off("resize",de),o&&clearInterval(o),n&&clearTimeout(n),u&&u(),_(),c=!1},"destroy"),fe=s(()=>{a&&B(e)&&(x=void 0,h=!0,L(),h=!1)},"handleExit");return m&&t.on("resize",de),v&&process.on("exit",fe),Y||(u=Nt(Q),ue()),{triggerRender:X,flushRender:ft,renderFinal:s(()=>{h=!0,L(!0),h=!1},"renderFinal"),destroy:pt,setMaxVisible:s(l=>{x=l},"setMaxVisible")}},"createRenderer");let ie;const zt=s(e=>{ie=e},"setRenderCallback"),Ut=s(e=>new Proxy(e,{set(t,r,o){return Reflect.set(t,r,o),ie&&ie(),!0}}),"reactive"),le=Symbol("run"),Yt=5,Ht=s((e,t)=>{const r=[];let o=0,n="";const i=s(c=>{var u;return(u=c.split("\r").reverse().find(Boolean))!=null?u:""},"resolveCarriageReturn"),a=s(()=>{const c=n.includes("\r")?i(n):n,u=c?[...r,c].join(`
`):r.join(`
`);e.streamOutput=u,e.streamTruncatedLines=Math.max(0,o-t)},"flush");return new Z.Writable({write(c,u,m){const v=Pt(n+c.toString()).split(/\r?\n/);n=v.pop();for(const T of v){const _=T.includes("\r")?i(T):T;r.push(_),o+=1,r.length>t&&r.shift()}if(n.includes("\r")){const T=i(n);n=n.endsWith("\r")?`${T}\r`:T}(v.length>0||n)&&a(),m()},final(c){if(n){const u=n.includes("\r")?i(n):n;r.push(u),o+=1,r.length>t&&r.shift(),n="",a()}c()}})},"createStreamPreview"),Jt=s((e,t)=>{let r;const o={task:dt(e.children),setTitle(n){e.title=n},setStatus(n){e.status=n},setOutput(n){e.output=typeof n=="string"?n:"message"in n?n.message:""},get streamPreview(){var n;return r||(r=Ht(e,Math.max(1,Math.trunc((n=t==null?void 0:t.previewLines)!=null?n:Yt)))),r},setWarning(n){e.state="warning",n!==void 0&&o.setOutput(n)},setError(n){e.state="error",n!==void 0&&o.setOutput(n)},startTime:s(()=>{e.startedAt=Date.now(),e.elapsedMs=void 0},"startTime"),stopTime:s(()=>e.startedAt===void 0?0:(e.elapsedMs=Date.now()-e.startedAt,e.startedAt=void 0,e.elapsedMs),"stopTime")};return{api:o,destroyStream:s(()=>r==null?void 0:r.destroy(),"destroyStream")}},"createTaskInnerApi");let g;const ut=s((e,t,r,o)=>{g||(g=qt(e),zt(()=>g.triggerRender()),e.isRoot=!0);const n=Ut({title:t,state:"pending",children:[]});return e.push(n),{task:n,[le]:async()=>{const{api:i,destroyStream:a}=Jt(n,o);n.state="loading",o!=null&&o.showTime&&i.startTime();let c;try{c=await r(i)}catch(u){throw i.stopTime(),i.setError(u),a(),g==null||g.flushRender(),u}return i.stopTime(),a(),n.state==="loading"&&(n.state="success"),g==null||g.flushRender(),c},clear:s(()=>{const i=e.indexOf(n);i!==-1&&e.splice(i,1),g&&(e.isRoot&&e.length===0?(g.renderFinal(),g.destroy(),g=void 0):g.triggerRender())},"clear")}},"registerTask");function dt(e){const t=s(async(r,o,n)=>{const i=ut(e,r,o,n);return{result:await i[le](),get state(){return i.task.state},clear:i.clear}},"task");return t.group=(async(r,o)=>{const n=r((a,c)=>ut(e,a,c));(o==null?void 0:o.maxVisible)!==void 0&&g&&g.setMaxVisible(o.maxVisible);const i=await St(n,async a=>({result:await a[le](),get state(){return a.task.state},clear:a.clear}),{concurrency:1,...o});return Object.assign(i,{clear:s(()=>{for(const a of n)a.clear();(o==null?void 0:o.maxVisible)!==void 0&&g&&g.setMaxVisible(void 0)},"clear")})}),t}s(dt,"createTaskFunction");const kt=[];var Qt=dt(kt);module.exports=Qt;
